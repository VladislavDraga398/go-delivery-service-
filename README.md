# ะกะธััะตะผะฐ ััะตัะฐ ะดะพััะฐะฒะบะธ ะทะฐะบะฐะทะพะฒ

ะะพะปะฝะพััะฝะบัะธะพะฝะฐะปัะฝะฐั ัะธััะตะผะฐ ัะฟัะฐะฒะปะตะฝะธั ะดะพััะฐะฒะบะพะน ะทะฐะบะฐะทะพะฒ, ะฟะพัััะพะตะฝะฝะฐั ะฝะฐ Go ั ะธัะฟะพะปัะทะพะฒะฐะฝะธะตะผ ัะพะฒัะตะผะตะฝะฝัั ัะตัะฝะพะปะพะณะธะน: PostgreSQL, Redis, Kafka ะธ Docker.

## ๐ ะกะพะดะตัะถะฐะฝะธะต

- [ะะฟะธัะฐะฝะธะต ะฟัะพะตะบัะฐ](#ะพะฟะธัะฐะฝะธะต-ะฟัะพะตะบัะฐ)
- [ะััะธัะตะบัััะฐ](#ะฐััะธัะตะบัััะฐ)
- [ะขะตัะฝะพะปะพะณะธะธ](#ัะตัะฝะพะปะพะณะธะธ)
- [ะขัะตะฑะพะฒะฐะฝะธั](#ััะตะฑะพะฒะฐะฝะธั)
- [ะัััััะน ััะฐัั](#ะฑัััััะน-ััะฐัั)
- [API ะดะพะบัะผะตะฝัะฐัะธั](#api-ะดะพะบัะผะตะฝัะฐัะธั)
- [ะะพะฝัะธะณััะฐัะธั](#ะบะพะฝัะธะณััะฐัะธั)
- [ะะฐะทะฒะตัััะฒะฐะฝะธะต](#ัะฐะทะฒะตัััะฒะฐะฝะธะต)
- [ะะพะฝะธัะพัะธะฝะณ](#ะผะพะฝะธัะพัะธะฝะณ)
- [ะะฐะทัะฐะฑะพัะบะฐ](#ัะฐะทัะฐะฑะพัะบะฐ)
- [ะะฐะดะฐัะธ ะดะปั ะดะพัะฐะฑะพัะบะธ](#ะทะฐะดะฐัะธ-ะดะปั-ะดะพัะฐะฑะพัะบะธ)

## ๐ฏ ะะฟะธัะฐะฝะธะต ะฟัะพะตะบัะฐ

ะกะธััะตะผะฐ ััะตัะฐ ะดะพััะฐะฒะบะธ ะทะฐะบะฐะทะพะฒ - ััะพ ััะตะฑะฝัะน ะฟัะพะตะบั, ะดะตะผะพะฝัััะธััััะธะน ะปัััะธะต ะฟัะฐะบัะธะบะธ ัะฐะทัะฐะฑะพัะบะธ ะฝะฐ Go. ะกะธััะตะผะฐ ะฟะพะทะฒะพะปัะตั:

- **ะฃะฟัะฐะฒะปััั ะทะฐะบะฐะทะฐะผะธ**: ัะพะทะดะฐะฝะธะต, ะพััะปะตะถะธะฒะฐะฝะธะต ััะฐัััะพะฒ, ะพะฑะฝะพะฒะปะตะฝะธะต
- **ะฃะฟัะฐะฒะปััั ะบัััะตัะฐะผะธ**: ัะตะณะธัััะฐัะธั, ะฝะฐะทะฝะฐัะตะฝะธะต ะทะฐะบะฐะทะพะฒ, ะพััะปะตะถะธะฒะฐะฝะธะต ะผะตััะพะฟะพะปะพะถะตะฝะธั
- **ะะฑัะฐะฑะฐััะฒะฐัั ัะพะฑััะธั**: ะฐัะธะฝััะพะฝะฝะฐั ะพะฑัะฐะฑะพัะบะฐ ัะตัะตะท Kafka
- **ะะตัะธัะพะฒะฐัั ะดะฐะฝะฝัะต**: ะฑัััััะน ะดะพัััะฟ ัะตัะตะท Redis
- **ะะพะฝะธัะพัะธัั ัะพััะพัะฝะธะต**: health checks ะธ ะผะตััะธะบะธ

## ๐ ะััะธัะตะบัััะฐ

```
โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ
โ   HTTP Client   โโโโโโ   API Gateway   โโโโโโ   Load Balancer โ
โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ
                                 โ
                        โโโโโโโโโโโโโโโโโโโ
                        โ   HTTP Server   โ
                        โ   (Go std lib)  โ
                        โโโโโโโโโโโโโโโโโโโ
                                 โ
                โโโโโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโโโ
                โ                โ                โ
        โโโโโโโโโโโโโโโโโ โโโโโโโโโโโโโโโ โโโโโโโโโโโโโโโ
        โ   Handlers    โ โ  Services   โ โ Middleware  โ
        โโโโโโโโโโโโโโโโโ โโโโโโโโโโโโโโโ โโโโโโโโโโโโโโโ
                โ                โ                โ
        โโโโโโโโโโโโโโโโโ โโโโโโโโโโโโโโโ โโโโโโโโโโโโโโโ
        โ   Kafka       โ โ PostgreSQL  โ โ    Redis    โ
        โ  (Events)     โ โ(Primary DB) โ โ   (Cache)   โ
        โโโโโโโโโโโโโโโโโ โโโโโโโโโโโโโโโ โโโโโโโโโโโโโโโ
```

### ะะพะผะฟะพะฝะตะฝัั ัะธััะตะผั:

1. **HTTP API**: RESTful API ะฑะตะท ะฒะฝะตัะฝะธั ััะตะนะผะฒะพัะบะพะฒ
2. **Business Logic**: ะกะตัะฒะธัั ะดะปั ะพะฑัะฐะฑะพัะบะธ ะฑะธะทะฝะตั-ะปะพะณะธะบะธ
3. **Data Layer**: PostgreSQL ะดะปั ะฟะตััะธััะตะฝัะฝะพััะธ, Redis ะดะปั ะบะตัะธัะพะฒะฐะฝะธั
4. **Event System**: Kafka ะดะปั ะฐัะธะฝััะพะฝะฝะพะน ะพะฑัะฐะฑะพัะบะธ ัะพะฑััะธะน
5. **Monitoring**: Health checks ะธ ะปะพะณะธัะพะฒะฐะฝะธะต

## ๐ ะขะตัะฝะพะปะพะณะธะธ

- **ะฏะทัะบ**: Go 1.21+
- **ะะฐะทะฐ ะดะฐะฝะฝัั**: PostgreSQL 15
- **ะะตั**: Redis 7
- **ะัะตัะตะดะธ**: Apache Kafka
- **ะะพะฝัะตะนะฝะตัะธะทะฐัะธั**: Docker & Docker Compose
- **ะะพะณะธัะพะฒะฐะฝะธะต**: Structured logging (JSON)

### ะัะฝะพะฒะฝัะต ะทะฐะฒะธัะธะผะพััะธ:

```go
github.com/IBM/sarama v1.41.2          // Kafka client
github.com/go-redis/redis/v8 v8.11.5   // Redis client
github.com/lib/pq v1.10.9              // PostgreSQL driver
github.com/google/uuid v1.3.1          // UUID generation
github.com/sirupsen/logrus v1.9.3      // Structured logging
```

## ๐ ะขัะตะฑะพะฒะฐะฝะธั

- **Go**: ะฒะตััะธั 1.21 ะธะปะธ ะฒััะต
- **Docker**: ะฒะตััะธั 20.0 ะธะปะธ ะฒััะต
- **Docker Compose**: ะฒะตััะธั 2.0 ะธะปะธ ะฒััะต
- **Make**: ะดะปั ัะดะพะฑััะฒะฐ ัะฐะทัะฐะฑะพัะบะธ (ะพะฟัะธะพะฝะฐะปัะฝะพ)

## ๐ ะัััััะน ััะฐัั

### 1. ะะปะพะฝะธัะพะฒะฐะฝะธะต ัะตะฟะพะทะธัะพัะธั

```bash
git clone <repository-url>
cd delivery-system
```

### 2. ะะฐะฟััะบ ะธะฝััะฐััััะบัััั

```bash
# ะะฐะฟััะบ ะฒัะตั ัะตัะฒะธัะพะฒ (PostgreSQL, Redis, Kafka, ะฟัะธะปะพะถะตะฝะธะต)
docker-compose up -d

# ะะปะธ ะทะฐะฟััะบ ัะพะปัะบะพ ะธะฝััะฐััััะบัััั ะดะปั ะปะพะบะฐะปัะฝะพะน ัะฐะทัะฐะฑะพัะบะธ
docker-compose up -d postgres redis kafka zookeeper
```

### 3. ะะฐะฟััะบ ะฟัะธะปะพะถะตะฝะธั ะปะพะบะฐะปัะฝะพ

```bash
# ะฃััะฐะฝะพะฒะบะฐ ะทะฐะฒะธัะธะผะพััะตะน
go mod download

# ะะฐะฟััะบ ะฟัะธะปะพะถะตะฝะธั
go run cmd/server/main.go
```

### 4. ะัะพะฒะตัะบะฐ ัะฐะฑะพัะพัะฟะพัะพะฑะฝะพััะธ

```bash
# Health check
curl http://localhost:8080/health

# ะกะพะทะดะฐะฝะธะต ะบัััะตัะฐ
curl -X POST http://localhost:8080/api/couriers \
  -H "Content-Type: application/json" \
  -d '{"name": "ะะฒะฐะฝ ะะตััะพะฒ", "phone": "+7(999)123-45-67"}'

# ะกะพะทะดะฐะฝะธะต ะทะฐะบะฐะทะฐ
curl -X POST http://localhost:8080/api/orders \
  -H "Content-Type: application/json" \
  -d '{
    "customer_name": "ะะฝะฝะฐ ะกะผะธัะฝะพะฒะฐ",
    "customer_phone": "+7(999)987-65-43",
    "delivery_address": "ะะพัะบะฒะฐ, ัะป. ะะตะฝะธะฝะฐ, ะด. 10, ะบะฒ. 5",
    "items": [
      {"name": "ะะธััะฐ ะะฐัะณะฐัะธัะฐ", "quantity": 1, "price": 500.00},
      {"name": "ะะพะบะฐ-ะบะพะปะฐ 0.5ะป", "quantity": 2, "price": 100.00}
    ]
  }'
```

## ๐ API ะดะพะบัะผะตะฝัะฐัะธั

### ะะฐะบะฐะทั (Orders)

#### ะกะพะทะดะฐะฝะธะต ะทะฐะบะฐะทะฐ
```http
POST /api/orders
Content-Type: application/json

{
  "customer_name": "ะะผั ะบะปะธะตะฝัะฐ",
  "customer_phone": "+7(999)123-45-67",
  "delivery_address": "ะะดัะตั ะดะพััะฐะฒะบะธ",
  "items": [
    {
      "name": "ะะฐะทะฒะฐะฝะธะต ัะพะฒะฐัะฐ",
      "quantity": 1,
      "price": 100.50
    }
  ]
}
```

#### ะะพะปััะตะฝะธะต ะทะฐะบะฐะทะฐ
```http
GET /api/orders/{order_id}
```

#### ะะพะปััะตะฝะธะต ัะฟะธัะบะฐ ะทะฐะบะฐะทะพะฒ
```http
GET /api/orders?status=created&courier_id={uuid}&limit=20&offset=0
```

#### ะะฑะฝะพะฒะปะตะฝะธะต ััะฐัััะฐ ะทะฐะบะฐะทะฐ
```http
PUT /api/orders/{order_id}/status
Content-Type: application/json

{
  "status": "in_delivery",
  "courier_id": "uuid-ะบัััะตัะฐ"
}
```

### ะัััะตัั (Couriers)

#### ะกะพะทะดะฐะฝะธะต ะบัััะตัะฐ
```http
POST /api/couriers
Content-Type: application/json

{
  "name": "ะะผั ะบัััะตัะฐ",
  "phone": "+7(999)123-45-67"
}
```

#### ะะพะปััะตะฝะธะต ะบัััะตัะฐ
```http
GET /api/couriers/{courier_id}
```

#### ะะพะปััะตะฝะธะต ัะฟะธัะบะฐ ะบัััะตัะพะฒ
```http
GET /api/couriers?status=available&min_rating=4.5&limit=20&offset=0
```

#### ะะพะปััะตะฝะธะต ะดะพัััะฟะฝัั ะบัััะตัะพะฒ
```http
GET /api/couriers/available
```

#### ะะฑะฝะพะฒะปะตะฝะธะต ััะฐัััะฐ ะบัััะตัะฐ
```http
PUT /api/couriers/{courier_id}/status
Content-Type: application/json

{
  "status": "available",
  "current_lat": 55.7558,
  "current_lon": 37.6176
}
```

#### ะะฐะทะฝะฐัะตะฝะธะต ะทะฐะบะฐะทะฐ ะบัััะตัั
```http
POST /api/couriers/{courier_id}/assign
Content-Type: application/json

{
  "order_id": "uuid-ะทะฐะบะฐะทะฐ"
}
```

### ะกัะฐัััั

#### ะกัะฐัััั ะทะฐะบะฐะทะพะฒ:
- `created` - ัะพะทะดะฐะฝ
- `accepted` - ะฟัะธะฝัั
- `preparing` - ะณะพัะพะฒะธััั
- `ready` - ะณะพัะพะฒ ะบ ะดะพััะฐะฒะบะต
- `in_delivery` - ะฒ ะดะพััะฐะฒะบะต
- `delivered` - ะดะพััะฐะฒะปะตะฝ
- `cancelled` - ะพัะผะตะฝะตะฝ

#### ะกัะฐัััั ะบัััะตัะพะฒ:
- `offline` - ะฝะต ะฒ ัะตัะธ
- `available` - ะดะพัััะฟะตะฝ
- `busy` - ะทะฐะฝัั

### Health Check

```http
GET /health              # ะะพะปะฝะฐั ะฟัะพะฒะตัะบะฐ ะฒัะตั ะบะพะผะฟะพะฝะตะฝัะพะฒ
GET /health/readiness    # ะัะพะฒะตัะบะฐ ะณะพัะพะฒะฝะพััะธ ะบ ะพะฑัะฐะฑะพัะบะต ะทะฐะฟัะพัะพะฒ
GET /health/liveness     # ะัะพะฒะตัะบะฐ ะถะธะทะฝะตัะฟะพัะพะฑะฝะพััะธ ะฟัะธะปะพะถะตะฝะธั
```

## โ๏ธ ะะพะฝัะธะณััะฐัะธั

ะะพะฝัะธะณััะฐัะธั ะพัััะตััะฒะปัะตััั ัะตัะตะท ะฟะตัะตะผะตะฝะฝัะต ะพะบััะถะตะฝะธั:

### ะกะตัะฒะตั
```bash
SERVER_HOST=0.0.0.0          # ะฅะพัั ัะตัะฒะตัะฐ
SERVER_PORT=8080             # ะะพัั ัะตัะฒะตัะฐ
SERVER_READ_TIMEOUT=10       # ะขะฐะนะผะฐัั ััะตะฝะธั (ัะตะบ)
SERVER_WRITE_TIMEOUT=10      # ะขะฐะนะผะฐัั ะทะฐะฟะธัะธ (ัะตะบ)
```

### ะะฐะทะฐ ะดะฐะฝะฝัั
```bash
DB_HOST=localhost            # ะฅะพัั PostgreSQL
DB_PORT=5432                # ะะพัั PostgreSQL
DB_USER=delivery_user       # ะะพะปัะทะพะฒะฐัะตะปั ะะ
DB_PASSWORD=delivery_pass   # ะะฐัะพะปั ะะ
DB_NAME=delivery_system     # ะะฐะทะฒะฐะฝะธะต ะะ
DB_SSL_MODE=disable         # ะะตะถะธะผ SSL
```

### Redis
```bash
REDIS_HOST=localhost        # ะฅะพัั Redis
REDIS_PORT=6379            # ะะพัั Redis
REDIS_PASSWORD=            # ะะฐัะพะปั Redis (ะตัะปะธ ะตััั)
REDIS_DB=0                 # ะะพะผะตั ะะ Redis
```

### Kafka
```bash
KAFKA_BROKERS=localhost:9092              # ะัะพะบะตัั Kafka
KAFKA_GROUP_ID=delivery-service           # ID ะณััะฟะฟั ะฟะพััะตะฑะธัะตะปะตะน
KAFKA_TOPIC_ORDERS=orders                 # ะขะพะฟะธะบ ะดะปั ะทะฐะบะฐะทะพะฒ
KAFKA_TOPIC_COURIERS=couriers             # ะขะพะฟะธะบ ะดะปั ะบัััะตัะพะฒ
KAFKA_TOPIC_LOCATIONS=locations           # ะขะพะฟะธะบ ะดะปั ะผะตััะพะฟะพะปะพะถะตะฝะธะน
```

### ะะพะณะธัะพะฒะฐะฝะธะต
```bash
LOG_LEVEL=info             # ะฃัะพะฒะตะฝั ะปะพะณะธัะพะฒะฐะฝะธั (debug, info, warn, error)
LOG_FORMAT=json            # ะคะพัะผะฐั ะปะพะณะพะฒ (json, text)
LOG_FILE=                  # ะคะฐะนะป ะปะพะณะพะฒ (ะฟัััะพะน = stdout)
```

## ๐ณ ะะฐะทะฒะตัััะฒะฐะฝะธะต

### ะะพะบะฐะปัะฝะฐั ัะฐะทัะฐะฑะพัะบะฐ

1. **ะะฐะฟััะบ ะธะฝััะฐััััะบัััั**:
```bash
docker-compose up -d postgres redis kafka zookeeper
```

2. **ะะธะณัะฐัะธะธ ะะ**:
```bash
# ะัะฟะพะปะฝััััั ะฐะฒัะพะผะฐัะธัะตัะบะธ ะฟัะธ ะทะฐะฟััะบะต PostgreSQL
# ะคะฐะนะปั ะผะธะณัะฐัะธะน ะฝะฐัะพะดัััั ะฒ ./migrations/
```

3. **ะะฐะฟััะบ ะฟัะธะปะพะถะตะฝะธั**:
```bash
go run cmd/server/main.go
```

### Production

1. **ะะพะปะฝัะน ะทะฐะฟััะบ ัะตัะตะท Docker Compose**:
```bash
docker-compose up -d
```

2. **ะัะพะฒะตัะบะฐ ััะฐัััะฐ**:
```bash
docker-compose ps
curl http://localhost:8080/health
```

3. **ะัะพัะผะพัั ะปะพะณะพะฒ**:
```bash
docker-compose logs -f delivery-app
```

### Kubernetes (ะดะปั ะฟัะพะดะฐะบัะตะฝะฐ)

```yaml
# ะัะธะผะตั deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: delivery-system
spec:
  replicas: 3
  selector:
    matchLabels:
      app: delivery-system
  template:
    metadata:
      labels:
        app: delivery-system
    spec:
      containers:
      - name: delivery-system
        image: delivery-system:latest
        ports:
        - containerPort: 8080
        env:
        - name: DB_HOST
          value: "postgres-service"
        - name: REDIS_HOST
          value: "redis-service"
        - name: KAFKA_BROKERS
          value: "kafka-service:9092"
        livenessProbe:
          httpGet:
            path: /health/liveness
            port: 8080
          initialDelaySeconds: 30
        readinessProbe:
          httpGet:
            path: /health/readiness
            port: 8080
          initialDelaySeconds: 5
```

## ๐ ะะพะฝะธัะพัะธะฝะณ

### Health Checks

ะกะธััะตะผะฐ ะฟัะตะดะพััะฐะฒะปัะตั ะฝะตัะบะพะปัะบะพ ัะฝะดะฟะพะธะฝัะพะฒ ะดะปั ะผะพะฝะธัะพัะธะฝะณะฐ:

- `/health` - ะฟะพะปะฝะฐั ะฟัะพะฒะตัะบะฐ ะทะดะพัะพะฒัั ะฒัะตั ะบะพะผะฟะพะฝะตะฝัะพะฒ
- `/health/readiness` - ะณะพัะพะฒะฝะพััั ะบ ะพะฑัะปัะถะธะฒะฐะฝะธั ะทะฐะฟัะพัะพะฒ
- `/health/liveness` - ะถะธะทะฝะตัะฟะพัะพะฑะฝะพััั ะฟัะธะปะพะถะตะฝะธั

### ะะพะณะธัะพะฒะฐะฝะธะต

ะกะธััะตะผะฐ ะธัะฟะพะปัะทัะตั ััััะบัััะธัะพะฒะฐะฝะฝะพะต ะปะพะณะธัะพะฒะฐะฝะธะต ะฒ ัะพัะผะฐัะต JSON:

```json
{
  "level": "info",
  "msg": "Order created successfully",
  "order_id": "123e4567-e89b-12d3-a456-426614174000",
  "customer_name": "ะะฝะฝะฐ ะกะผะธัะฝะพะฒะฐ",
  "total_amount": 700,
  "time": "2024-01-15T10:30:00Z"
}
```

### ะะตััะธะบะธ (ัะตะบะพะผะตะฝะดัะตะผัะต ะดะปั ะดะพะฑะฐะฒะปะตะฝะธั)

- ะะพะปะธัะตััะฒะพ ัะพะทะดะฐะฝะฝัั ะทะฐะบะฐะทะพะฒ
- ะกัะตะดะฝะตะต ะฒัะตะผั ะดะพััะฐะฒะบะธ
- ะะพะปะธัะตััะฒะพ ะฐะบัะธะฒะฝัั ะบัััะตัะพะฒ
- ะัะพะธะทะฒะพะดะธัะตะปัะฝะพััั API (latency, throughput)

## ๐จโ๐ป ะะฐะทัะฐะฑะพัะบะฐ

### ะกัััะบัััะฐ ะฟัะพะตะบัะฐ

```
delivery-system/
โโโ cmd/
โ   โโโ server/           # ะขะพัะบะฐ ะฒัะพะดะฐ ะฟัะธะปะพะถะตะฝะธั
โโโ internal/
โ   โโโ config/          # ะะพะฝัะธะณััะฐัะธั
โ   โโโ database/        # ะะฐะฑะพัะฐ ั ะะ
โ   โโโ handlers/        # HTTP ะพะฑัะฐะฑะพััะธะบะธ
โ   โโโ kafka/           # Kafka producer/consumer
โ   โโโ logger/          # ะะพะณะธัะพะฒะฐะฝะธะต
โ   โโโ models/          # ะะพะดะตะปะธ ะดะฐะฝะฝัั
โ   โโโ redis/           # Redis ะบะปะธะตะฝั
โ   โโโ services/        # ะะธะทะฝะตั-ะปะพะณะธะบะฐ
โโโ migrations/          # SQL ะผะธะณัะฐัะธะธ
โโโ docker/             # Docker ัะฐะนะปั
โโโ docs/               # ะะพะบัะผะตะฝัะฐัะธั
โโโ docker-compose.yml  # ะะพะบะฐะปัะฝะฐั ัะฐะทัะฐะฑะพัะบะฐ
โโโ Dockerfile          # Production ะพะฑัะฐะท
โโโ go.mod              # Go ะผะพะดัะปะธ
โโโ README.md
```

### ะกะพะณะปะฐัะตะฝะธั ะฟะพ ะบะพะดั

1. **ะะผะตะฝะพะฒะฐะฝะธะต**: camelCase ะดะปั ะฟะตัะตะผะตะฝะฝัั, PascalCase ะดะปั ัะธะฟะพะฒ
2. **ะะฑัะฐะฑะพัะบะฐ ะพัะธะฑะพะบ**: ะฒัะตะณะดะฐ ะพะฑัะฐะฑะฐััะฒะฐะนัะต ะพัะธะฑะบะธ ัะฒะฝะพ
3. **ะะพะณะธัะพะฒะฐะฝะธะต**: ะธัะฟะพะปัะทัะนัะต ััััะบัััะธัะพะฒะฐะฝะฝัะต ะปะพะณะธ ั ะบะพะฝัะตะบััะพะผ
4. **ะขะตััั**: ะฟะพะบัััะธะต ะดะพะปะถะฝะพ ะฑััั ะฝะต ะผะตะฝะตะต 80%

### ะะพะฑะฐะฒะปะตะฝะธะต ะฝะพะฒัั API

1. ะกะพะทะดะฐะนัะต ะผะพะดะตะปั ะฒ `internal/models/`
2. ะะพะฑะฐะฒััะต ะฑะธะทะฝะตั-ะปะพะณะธะบั ะฒ `internal/services/`
3. ะกะพะทะดะฐะนัะต HTTP ะพะฑัะฐะฑะพััะธะบ ะฒ `internal/handlers/`
4. ะะฐัะตะณะธัััะธััะนัะต ะผะฐััััั ะฒ `cmd/server/main.go`

### ะะธะณัะฐัะธะธ ะะ

ะะปั ะดะพะฑะฐะฒะปะตะฝะธั ะฝะพะฒะพะน ะผะธะณัะฐัะธะธ:

1. ะกะพะทะดะฐะนัะต ัะฐะนะปั `XXX_name.up.sql` ะธ `XXX_name.down.sql` ะฒ ะฟะฐะฟะบะต `migrations/`
2. ะะตัะตะทะฐะฟัััะธัะต PostgreSQL ะบะพะฝัะตะนะฝะตั

## ๐ฏ ะะฐะดะฐัะธ ะดะปั ะดะพัะฐะฑะพัะบะธ

### 1. ะกะธััะตะผะฐ ัะตะนัะธะฝะณะพะฒ ะบัััะตัะพะฒ ะธ ะพัะทัะฒะพะฒ ะบะปะธะตะฝัะพะฒ
**ะกะปะพะถะฝะพััั**: ะกัะตะดะฝัั  
**ะัะตะผั**: 6-8 ัะฐัะพะฒ

**ะะฟะธัะฐะฝะธะต**: ะะตะฐะปะธะทะพะฒะฐัั ัะธััะตะผั ะพัะตะฝะบะธ ะบะฐัะตััะฒะฐ ะดะพััะฐะฒะบะธ ะดะปั ะฟะพะฒััะตะฝะธั ัะตัะฒะธัะฐ.

**ะะฐะดะฐัะธ**:
- ะะพะฑะฐะฒะธัั ัะฐะฑะปะธัั `reviews` ะธ ะพะฑะฝะพะฒะธัั ะผะพะดะตะปั `couriers` (ะดะพะฑะฐะฒะธัั ะฟะพะปั `rating`, `total_reviews`)
- ะกะพะทะดะฐัั API ะดะปั ะพััะฐะฒะปะตะฝะธั ะพัะทัะฒะฐ ะฟะพัะปะต ะดะพััะฐะฒะบะธ (`POST /api/orders/{id}/review`)
- ะะตะฐะปะธะทะพะฒะฐัั ัะฐััะตั ััะตะดะฝะตะณะพ ัะตะนัะธะฝะณะฐ ะบัััะตัะฐ ะธ ะพะฑะฝะพะฒะปะตะฝะธะต ะฒ ัะตะฐะปัะฝะพะผ ะฒัะตะผะตะฝะธ
- ะะพะฑะฐะฒะธัั API ะดะปั ะฟะพะปััะตะฝะธั ะพัะทัะฒะพะฒ ะบัััะตัะฐ (`GET /api/couriers/{id}/reviews`)
- ะะพะฑะฐะฒะธัั ัะธะปัััะฐัะธั ะบัััะตัะพะฒ ะฟะพ ัะตะนัะธะฝะณั ะฒ API ะฟะพะปััะตะฝะธั ะดะพัััะฟะฝัั ะบัััะตัะพะฒ

**ะัะธัะตัะธะธ ะณะพัะพะฒะฝะพััะธ**:
- ะะปะธะตะฝัั ะผะพะณัั ะพััะฐะฒะปััั ะพัะตะฝะบะธ (1-5 ะทะฒะตะทะด) ะธ ัะตะบััะพะฒัะต ะพัะทัะฒั
- ะะตะนัะธะฝะณ ะบัััะตัะฐ ะฐะฒัะพะผะฐัะธัะตัะบะธ ะฟะตัะตััะธััะฒะฐะตััั ะฟัะธ ะฝะพะฒัั ะพัะทัะฒะฐั
- API ะฒะพะทะฒัะฐัะฐะตั ัะพะฟ-ะบัััะตัะพะฒ ะฟะพ ัะตะนัะธะฝะณั ะดะปั ะฟัะธะพัะธัะตัะฝะพะณะพ ะฝะฐะทะฝะฐัะตะฝะธั

### 2. ะะฒัะพะผะฐัะธัะตัะบะพะต ะฝะฐะทะฝะฐัะตะฝะธะต ะพะฟัะธะผะฐะปัะฝะพะณะพ ะบัััะตัะฐ
**ะกะปะพะถะฝะพััั**: ะกัะตะดะฝัั  
**ะัะตะผั**: 7-8 ัะฐัะพะฒ

**ะะฟะธัะฐะฝะธะต**: ะะตะฐะปะธะทะพะฒะฐัั ัะผะฝัะน ะฐะปะณะพัะธัะผ ะฝะฐะทะฝะฐัะตะฝะธั ะบัััะตัะพะฒ ะฝะฐ ะพัะฝะพะฒะต ะผะตััะพะฟะพะปะพะถะตะฝะธั ะธ ัะตะนัะธะฝะณะฐ.

**ะะฐะดะฐัะธ**:
- ะกะพะทะดะฐัั ัะตัะฒะธั `CourierAssignmentService` ั ะฐะปะณะพัะธัะผะพะผ ะฒัะฑะพัะฐ ะพะฟัะธะผะฐะปัะฝะพะณะพ ะบัััะตัะฐ
- ะะตะฐะปะธะทะพะฒะฐัั ัะฐััะตั ัะฐัััะพัะฝะธั ะพั ะบัััะตัะฐ ะดะพ ัะพัะบะธ ะฟะพะปััะตะฝะธั ะทะฐะบะฐะทะฐ
- ะะพะฑะฐะฒะธัั ะฒะตัะพะฒัะต ะบะพัััะธัะธะตะฝัั: ัะฐัััะพัะฝะธะต (40%), ัะตะนัะธะฝะณ (30%), ะทะฐะณััะถะตะฝะฝะพััั (30%)
- ะะพะฑะฐะฒะธัั API ะฐะฒัะพะฝะฐะทะฝะฐัะตะฝะธั (`POST /api/orders/{id}/auto-assign`)
- ะะฝัะตะณัะธัะพะฒะฐัั ะฐะฒัะพะฝะฐะทะฝะฐัะตะฝะธะต ะฒ ะฟัะพัะตัั ัะพะทะดะฐะฝะธั ะทะฐะบะฐะทะฐ ะบะฐะบ ะพะฟัะธั

**ะัะธัะตัะธะธ ะณะพัะพะฒะฝะพััะธ**:
- ะกะธััะตะผะฐ ะฐะฒัะพะผะฐัะธัะตัะบะธ ะฒัะฑะธัะฐะตั ะปัััะตะณะพ ะบัััะตัะฐ ะฝะฐ ะพัะฝะพะฒะต ะบัะธัะตัะธะตะฒ
- ะฃัะธััะฒะฐะตััั ัะตะบััะฐั ะทะฐะณััะถะตะฝะฝะพััั ะบัััะตัะพะฒ
- ะะพะณะธัะพะฒะฐะฝะธะต ะฟัะธัะธะฝ ะฒัะฑะพัะฐ ะบะพะฝะบัะตัะฝะพะณะพ ะบัััะตัะฐ ะดะปั ะฟัะพะทัะฐัะฝะพััะธ

### 3. ะะฐััะตั ััะพะธะผะพััะธ ะดะพััะฐะฒะบะธ ะฝะฐ ะพัะฝะพะฒะต ัะฐัััะพัะฝะธั
**ะกะปะพะถะฝะพััั**: ะะตะณะบะฐั  
**ะัะตะผั**: 4-6 ัะฐัะพะฒ

**ะะฟะธัะฐะฝะธะต**: ะะตะฐะปะธะทะพะฒะฐัั ะฐะฒัะพะผะฐัะธัะตัะบะธะน ัะฐััะตั ััะพะธะผะพััะธ ะดะพััะฐะฒะบะธ.

**ะะฐะดะฐัะธ**:
- ะะพะฑะฐะฒะธัั ะฟะพะปั `pickup_address`, `delivery_cost` ะฒ ะผะพะดะตะปั Order
- ะกะพะทะดะฐัั ัะตัะฒะธั ะดะปั ะณะตะพะบะพะดะธัะพะฒะฐะฝะธั ะฐะดัะตัะพะฒ (ะฝะฐะฟัะธะผะตั, ัะตัะตะท Yandex Maps API)
- ะะตะฐะปะธะทะพะฒะฐัั ะฐะปะณะพัะธัะผ ัะฐััะตัะฐ ััะพะธะผะพััะธ ะฝะฐ ะพัะฝะพะฒะต ัะฐัััะพัะฝะธั
- ะะพะฑะฐะฒะธัั ะฝะฐัััะพะนะบะธ ัะฐัะธัะพะฒ ะฒ ะบะพะฝัะธะณััะฐัะธั
- ะะฑะฝะพะฒะธัั API ัะพะทะดะฐะฝะธั ะทะฐะบะฐะทะฐ ะดะปั ะฐะฒัะพะผะฐัะธัะตัะบะพะณะพ ัะฐััะตัะฐ ััะพะธะผะพััะธ

**ะัะธัะตัะธะธ ะณะพัะพะฒะฝะพััะธ**:
- ะกัะพะธะผะพััั ะดะพััะฐะฒะบะธ ัะฐัััะธััะฒะฐะตััั ะฐะฒัะพะผะฐัะธัะตัะบะธ ะฟัะธ ัะพะทะดะฐะฝะธะธ ะทะฐะบะฐะทะฐ
- ะะตัะธัะพะฒะฐะฝะธะต ัะตะทัะปััะฐัะพะฒ ะณะตะพะบะพะดะธัะพะฒะฐะฝะธั ะฒ Redis
- ะะพะทะผะพะถะฝะพััั ัััะฝะพะณะพ override ััะพะธะผะพััะธ ะดะพััะฐะฒะบะธ

### 4. ะกะธััะตะผะฐ ะฟัะพะผะพะบะพะดะพะฒ ะธ ัะบะธะดะพะบ
**ะกะปะพะถะฝะพััั**: ะกัะตะดะฝัั  
**ะัะตะผั**: 6-7 ัะฐัะพะฒ

**ะะฟะธัะฐะฝะธะต**: ะะพะฑะฐะฒะธัั ะผะฐัะบะตัะธะฝะณะพะฒัะน ะธะฝััััะผะตะฝั ะดะปั ะฟัะธะฒะปะตัะตะฝะธั ะธ ัะดะตัะถะฐะฝะธั ะบะปะธะตะฝัะพะฒ.

**ะะฐะดะฐัะธ**:
- ะกะพะทะดะฐัั ัะฐะฑะปะธัั `promo_codes` ั ะฟะพะปัะผะธ: ะบะพะด, ัะธะฟ ัะบะธะดะบะธ, ัะฐะทะผะตั, ััะพะบ ะดะตะนััะฒะธั, ะปะธะผะธั ะธัะฟะพะปัะทะพะฒะฐะฝะธะน
- ะะพะฑะฐะฒะธัั ะฟะพะปะต `promo_code` ะธ `discount_amount` ะฒ ะผะพะดะตะปั Order  
- ะะตะฐะปะธะทะพะฒะฐัั API ัะฟัะฐะฒะปะตะฝะธั ะฟัะพะผะพะบะพะดะฐะผะธ (`POST/GET/PUT/DELETE /api/promo-codes`)
- ะะพะฑะฐะฒะธัั ะฒะฐะปะธะดะฐัะธั ะฟัะพะผะพะบะพะดะฐ ะฟัะธ ัะพะทะดะฐะฝะธะธ ะทะฐะบะฐะทะฐ
- ะะตะฐะปะธะทะพะฒะฐัั ัะฐะทะฝัะต ัะธะฟั ัะบะธะดะพะบ: ัะธะบัะธัะพะฒะฐะฝะฝะฐั ััะผะผะฐ, ะฟัะพัะตะฝั, ะฑะตัะฟะปะฐัะฝะฐั ะดะพััะฐะฒะบะฐ

**ะัะธัะตัะธะธ ะณะพัะพะฒะฝะพััะธ**:
- ะะดะผะธะฝะธัััะฐัะพัั ะผะพะณัั ัะพะทะดะฐะฒะฐัั ะธ ัะฟัะฐะฒะปััั ะฟัะพะผะพะบะพะดะฐะผะธ
- ะะปะธะตะฝัั ะผะพะณัั ะฟัะธะผะตะฝััั ะฟัะพะผะพะบะพะดั ะฟัะธ ะพัะพัะผะปะตะฝะธะธ ะทะฐะบะฐะทะฐ
- ะกะธััะตะผะฐ ะพััะปะตะถะธะฒะฐะตั ะธัะฟะพะปัะทะพะฒะฐะฝะธะต ะฟัะพะผะพะบะพะดะพะฒ ะธ ะฑะปะพะบะธััะตั ะธััะตะบัะธะต

### 5. ะกะธััะตะผะฐ ะพััะตัะฝะพััะธ ะธ ะฑะธะทะฝะตั-ะฐะฝะฐะปะธัะธะบะธ
**ะกะปะพะถะฝะพััั**: ะกัะตะดะฝัั  
**ะัะตะผั**: 7-8 ัะฐัะพะฒ

**ะะฟะธัะฐะฝะธะต**: ะะตะฐะปะธะทะพะฒะฐัั ะดะฐัะฑะพัะด ั ะบะปััะตะฒัะผะธ ะฑะธะทะฝะตั-ะผะตััะธะบะฐะผะธ ะดะปั ะฟัะธะฝััะธั ัะตัะตะฝะธะน.

**ะะฐะดะฐัะธ**:
- ะกะพะทะดะฐัั API ัะฝะดะฟะพะธะฝัั ะดะปั ะฑะธะทะฝะตั-ะผะตััะธะบ (`GET /api/analytics/*`)
- ะะตะฐะปะธะทะพะฒะฐัั ัะฐััะตั KPI: ะฒััััะบะฐ, ะบะพะปะธัะตััะฒะพ ะทะฐะบะฐะทะพะฒ, ััะตะดะฝะตะต ะฒัะตะผั ะดะพััะฐะฒะบะธ, ะฟะพะฟัะปััะฝัะต ัะพะฒะฐัั
- ะะพะฑะฐะฒะธัั ะณััะฟะฟะธัะพะฒะบั ะผะตััะธะบ ะฟะพ ะฟะตัะธะพะดะฐะผ (ะดะตะฝั, ะฝะตะดะตะปั, ะผะตััั)
- ะกะพะทะดะฐัั ะพััะตัั ะฟะพ ะบัััะตัะฐะผ: ัะตะนัะธะฝะณ, ะบะพะปะธัะตััะฒะพ ะดะพััะฐะฒะพะบ, ะทะฐัะฐะฑะพัะพะบ
- ะะตะฐะปะธะทะพะฒะฐัั ะบะตัะธัะพะฒะฐะฝะธะต ััะถะตะปัั ะฐะฝะฐะปะธัะธัะตัะบะธั ะทะฐะฟัะพัะพะฒ ะฒ Redis

**ะัะธัะตัะธะธ ะณะพัะพะฒะฝะพััะธ**:
- API ะฒะพะทะฒัะฐัะฐะตั ะฒัะต ะบะปััะตะฒัะต ะฑะธะทะฝะตั-ะผะตััะธะบะธ ั ัะธะปัััะฐัะธะตะน ะฟะพ ะดะฐัะฐะผ
- ะััะตัั ะณะตะฝะตัะธัััััั ะฑััััะพ ะฑะปะฐะณะพะดะฐัั ะบะตัะธัะพะฒะฐะฝะธั
- ะะฐะฝะฝัะต ะผะพะถะฝะพ ัะบัะฟะพััะธัะพะฒะฐัั ะฒ JSON/CSV ัะพัะผะฐัะต ะดะปั ะดะฐะปัะฝะตะนัะตะณะพ ะฐะฝะฐะปะธะทะฐ



---

## ะัััั ะฟะพ ัะตะฐะปะธะทะฐัะธะธ ะขะ (1โ5)

ะญัะพั ัะฐะทะดะตะป โ ะธัะพะณ ะดะปั ัะตะฒััะตัะฐ: ััะพ ัะตะฐะปะธะทะพะฒะฐะฝะพ ะฟะพ ะฟัะฝะบัะฐะผ 1โ5, ะณะดะต ััะพ ะฝะฐัะพะดะธััั ะฒ ะบะพะดะต ะธ ะบะฐะบ ะฑััััะพ ะฟัะพะฒะตัะธัั.
ะัะธะผะตัะฐะฝะธะต: ะฟะพัะปะตะดัััะธะต ะฑะปะพะบะธ `ะฃะถะต ัะตะฐะปะธะทะพะฒะฐะฝะฝะพ/ะะต ัะตะฐะปะธะทะพะฒะฐะฝะพ/ะกัะฐััั ัะตะฐะปะธะทะฐัะธะธ...` ะพััะฐะฒะปะตะฝั ะบะฐะบ ัะฐััั ะธััะพะดะฝะพะณะพ README ะธ ะผะพะณัั ะฑััั ะฝะตะฐะบััะฐะปัะฝั โ ะพัะธะตะฝัะธััะนัะตัั ะฝะฐ ััะพั ะพัััั.

### 1) ะะตะนัะธะฝะณะธ ะธ ะพัะทัะฒั
- **ะะ/ะดะฐะฝะฝัะต**: `reviews`, `couriers.rating/total_reviews`, `orders.rating/review_comment`, ััะธะณะณะตั ะฟะตัะตััััะฐ ัะตะนัะธะฝะณะฐ (`migrations/002_reviews.up.sql`).
- **API**: `POST /api/orders/{id}/review`, `GET /api/couriers/{id}/reviews` (ัะพััั ะฒ `cmd/server/main.go`).
- **ะะพะณะธะบะฐ**: ัะตะนัะธะฝะณ 1โ5, ะพัะทัะฒ ัะพะปัะบะพ ะฟะพัะปะต `delivered`, ะทะฐะฟัะตั ะฟะพะฒัะพัะฝะพะณะพ ะพัะทัะฒะฐ (`internal/services/order_service.go`).

### 2) ะะฒัะพะฝะฐะทะฝะฐัะตะฝะธะต ะบัััะตัะฐ
- **API**: `POST /api/orders/{id}/auto-assign` + `auto_assign` ะฒ `POST /api/orders` (`internal/handlers/orders.go`).
- **ะะปะณะพัะธัะผ**: scoring ะฟะพ ัะฐัััะพัะฝะธั/ัะตะนัะธะฝะณั/ะฝะฐะณััะทะบะต (ะฒะตัะฐ `0.40/0.30/0.30`) (`internal/services/courier_assignment_service.go`).
- **Kafka**: ะฟัะธ ะฐะฒัะพะฝะฐะทะฝะฐัะตะฝะธะธ ะธ ัััะฝะพะผ ะฝะฐะทะฝะฐัะตะฝะธะธ ะฟัะฑะปะธะบััััั `courier.assigned` ะธ `order.status_changed` (best effort) (`internal/handlers/orders.go`, `internal/handlers/couriers.go`).

### 3) ะกัะพะธะผะพััั ะดะพััะฐะฒะบะธ ะธ ะณะตะพะบะพะดะธะฝะณ
- **ะะฐัััั**: distance (haversine) โ `PricingService.CalculateCost` (base/per_km/min_fare) (`internal/services/pricing_service.go`, `internal/services/order_service.go`).
- **ะะตะพะบะพะดะตั**: `offline` ะธะปะธ `yandex` (ะพะฟัะธะพะฝะฐะปัะฝะพ), ะบะตั ะฒ Redis (`internal/services/geocoding_service.go`).
- **ะะพะฝััะฐะบั API**: `pickup_address` ะพะฑัะทะฐัะตะปะตะฝ ะฟัะธ ัะพะทะดะฐะฝะธะธ ะทะฐะบะฐะทะฐ (ะฒะฐะปะธะดะฐัะธั ะฒ `internal/handlers/orders.go`).

### 4) ะัะพะผะพะบะพะดั ะธ ัะบะธะดะบะธ
- **ะะ**: `promo_codes` + ะฟะพะปั `orders.promo_code/discount_amount` (`migrations/004_promo_codes.up.sql`).
- **API**: `/api/promo-codes` (CRUD) (`internal/handlers/promo_codes.go`).
- **ะะพะณะธะบะฐ**: ะฟัะธะผะตะฝะตะฝะธะต ัะบะธะดะบะธ ะฒ ััะฐะฝะทะฐะบัะธะธ (`SELECT ... FOR UPDATE` + `used_count++`) (`internal/services/promo_service.go`, `internal/services/order_service.go`).

### 5) ะะฝะฐะปะธัะธะบะฐ
- **API**: `/api/analytics/kpi`, `/api/analytics/couriers` (JSON/CSV ัะตัะตะท `format=csv`) (`internal/handlers/analytics.go`).
- **ะะตั**: ะบะตัะธัะพะฒะฐะฝะธะต ะฒ Redis + ะธะฝะฒะฐะปะธะดะฐัะธั stats-cache ะฟัะธ ัะผะตะฝะต ััะฐัััะฐ ะทะฐะบะฐะทะฐ ะธ ะฟัะธ ัะพะทะดะฐะฝะธะธ review (best effort) (`internal/services/analytics_service.go`, `internal/handlers/orders.go`).

## ะะฐะบ ะฟัะพะฒะตัะธัั (ััะตะฝะฐัะธะน ะดะปั ะขะ 1โ5)

ะะธะถะต ัะฐะณะธ ะธะดัั ะฒ **ะปะพะณะธัะตัะบะพะผ ะฟะพััะดะบะต ะฟัะพะฒะตัะบะธ**, ะฐ ะฒ ะทะฐะณะพะปะพะฒะบะฐั ัะบะฐะทะฐะฝะพ, ะบ ะบะฐะบะพะผั ะฟัะฝะบัั ะขะ ะพัะฝะพัะธััั ัะฐะณ.

### ะจะฐะณ 1 โ ะะพะดะฝััั ะพะบััะถะตะฝะธะต (Kafka/Redis/PostgreSQL)
```bash
make up && make health

# ะะถะธะดะฐะตะผ 200 ะธ status=healthy
curl -s -i http://localhost:8080/health
```

### ะจะฐะณ 2 โ ะขะโ2: ะะพะดะณะพัะพะฒะธัั ะบัััะตัะฐ ั ะปะพะบะฐัะธะตะน (ะฝัะถะฝะพ ะดะปั ะฐะฒัะพะฝะฐะทะฝะฐัะตะฝะธั)
```bash
phone="+7999$(date +%H%M%S)"
courier_id=$(curl -s -X POST http://localhost:8080/api/couriers \
  -H "Content-Type: application/json" \
  -d '{"name":"ะะฒะฐะฝ","phone":"'"$phone"'"}' | jq -r .id)

curl -s -X PUT "http://localhost:8080/api/couriers/${courier_id}/status" \
  -H "Content-Type: application/json" \
  -d '{"status":"available","current_lat":55.7558,"current_lon":37.6173}' | jq
```

### ะจะฐะณ 3 โ ะขะโ4: ะกะพะทะดะฐัั ะฟัะพะผะพะบะพะด (ะพะฟัะธะพะฝะฐะปัะฝะพ)
```bash
promo_code="SALE$(date +%H%M%S)"
curl -s -X POST http://localhost:8080/api/promo-codes \
  -H "Content-Type: application/json" \
  -d '{"code":"'"$promo_code"'","discount_type":"percent","amount":10,"max_uses":10,"active":true}' | jq
```

### ะจะฐะณ 4 โ ะขะโ3 (+ะขะโ2): ะกะพะทะดะฐัั ะทะฐะบะฐะท (ะณะตะพะบะพะดะธะฝะณ + ััะพะธะผะพััั) ะธ ะฐะฒัะพะฝะฐะทะฝะฐัะธัั ะบัััะตัะฐ
```bash
resp=$(curl -s -X POST http://localhost:8080/api/orders \
  -H "Content-Type: application/json" \
  -d '{
    "customer_name":"ะะฝะฝะฐ",
    "customer_phone":"+79990000002",
    "pickup_address":"ะะพัะบะฒะฐ, ัะบะปะฐะด โ1",
    "delivery_address":"ะะพัะบะฒะฐ, ัะป. ะะตะฝะธะฝะฐ, 10",
    "items":[{"name":"ะะธััะฐ","quantity":1,"price":500}],
    "promo_code":"'"$promo_code"'",
    "auto_assign":true
  }')

echo "$resp" | jq
order_id=$(echo "$resp" | jq -r '.order.id')
assigned_courier_id=$(echo "$resp" | jq -r '.assigned_courier.id')

# ะัะปะธ ะฐะฒัะพะฝะฐะทะฝะฐัะตะฝะธะต ะฝะต ััะฐะฑะพัะฐะปะพ (ะฝะฐะฟัะธะผะตั, ะฝะตั available ะบัััะตัะพะฒ), ะฝะฐะทะฝะฐัะฐะตะผ ะฒัััะฝัั ัะตัะตะท /auto-assign:
if [ -z "$assigned_courier_id" ] || [ "$assigned_courier_id" = "null" ]; then
  assigned_courier_id=$(curl -s -X POST "http://localhost:8080/api/orders/${order_id}/auto-assign" \
    -H "Content-Type: application/json" \
    -d '{}' | jq -r .id)
fi
```

### ะจะฐะณ 5 โ ะขะโ1: ะะพััะฐะฒะธัั ะทะฐะบะฐะท ะธ ะพััะฐะฒะธัั ะพัะทัะฒ
ะะฐะถะฝะพ: ะฟัะธ ัะผะตะฝะต ััะฐัััะฐ ะฟะตัะตะดะฐัะผ `courier_id`, ััะพะฑั ะฝะต โััะตัะตััโ ะฝะฐะทะฝะฐัะตะฝะธะต.
```bash
curl -s -X PUT "http://localhost:8080/api/orders/${order_id}/status" \
  -H "Content-Type: application/json" \
  -d '{"status":"delivered","courier_id":"'"$assigned_courier_id"'"}' | jq

curl -s -X POST "http://localhost:8080/api/orders/${order_id}/review" \
  -H "Content-Type: application/json" \
  -d '{"rating":5,"comment":"ะฑััััะพ ะธ ะฐะบะบััะฐัะฝะพ"}' | jq

curl -s "http://localhost:8080/api/couriers/${assigned_courier_id}/reviews?limit=10&offset=0" | jq
```

### ะจะฐะณ 6 โ ะขะโ5: ะัะพะฒะตัะธัั ะฐะฝะฐะปะธัะธะบั (JSON ะธ CSV)
```bash
# ะะปั "ะถะธะฒัั" ัะธัั ะธัะฟะพะปัะทัะตะผ ะดะธะฐะฟะฐะทะพะฝ, ะฒะบะปััะฐััะธะน ัะตะณะพะดะฝััะฝัั ะดะฐัั
to=$(date -u +%Y-%m-%d 2>/dev/null || date +%Y-%m-%d)
from=$(date -u -d '30 days ago' +%Y-%m-%d 2>/dev/null || date -u -v-30d +%Y-%m-%d)

curl -s "http://localhost:8080/api/analytics/kpi?from=${from}&to=${to}&group_by=day" | jq
curl -s "http://localhost:8080/api/analytics/kpi?from=${from}&to=${to}&group_by=day&format=csv" | head

curl -s "http://localhost:8080/api/analytics/couriers?from=${from}&to=${to}&format=csv" | head
```

### Kafka (ะพะฟัะธะพะฝะฐะปัะฝะพ: ะฟะพัะผะพััะตัั ัะพะฑััะธั ะฒ ัะพะฟะธะบะฐั)
```bash
docker exec -i kafka kafka-console-consumer --bootstrap-server kafka:29092 --topic orders --from-beginning --max-messages 5
docker exec -i kafka kafka-console-consumer --bootstrap-server kafka:29092 --topic couriers --from-beginning --max-messages 5
```

### Rate limiting (ะพะฟัะธะพะฝะฐะปัะฝะพ)
ะะพ ัะผะพะปัะฐะฝะธั ะฒัะบะปััะตะฝ (ัะผ. `RATE_LIMIT_ENABLED` ะฒ ะบะพะฝัะธะณะต). ะกัะฐััั:
```bash
curl -s http://localhost:8080/api/rate-limit/status | jq
```

## ะะพะด-ััะฐะนะป ะธ ะบะฐัะตััะฒะพ
- **ะกัััะบัััะฐ**: `handlers โ services โ db/redis/kafka`, ะฑะตะท web-ััะตะนะผะฒะพัะบะพะฒ (stdlib `net/http`) (`cmd/server/main.go`).
- **ะัะธะฑะบะธ**: ัะธะฟะธะทะธัะพะฒะฐะฝะฝัะต ะพัะธะฑะบะธ `internal/apperror` + ะตะดะธะฝัะน ะผะฐะฟะฟะธะฝะณ ะพัะธะฑะพะบ ัะตัะฒะธัะพะฒ ะฒ HTTP (ัะฑัะฐะฝั `strings.Contains(err.Error())`) (`internal/handlers/error_map.go`).
- **ะะพะฝัะตะบััั**: `context.Context` ะฟัะพะบะธะฝัั ัะตัะตะท handler โ service; DB ะฝะฐ `QueryContext/ExecContext/BeginTx` (ะบะปััะตะฒัะต ัะตัะฒะธัั ะฒ `internal/services/*`).

## ะขะตััั ะธ ะฟะพะบัััะธะต
- ะะพะบัััะธะต: `82%+` (ะปะพะบะฐะปัะฝะพ ัะธะบัะธัะพะฒะฐะปะพัั `82.5%`).
- ะะพะฒัะต/ะบะปััะตะฒัะต ัะตััั:
  - `internal/handlers/orders_handler_test.go` (ัะพะทะดะฐะฝะธะต ะทะฐะบะฐะทะฐ, review, auto-assign, ะฒะฐะปะธะดะฐัะธะธ/ะพัะธะฑะบะธ)
  - `internal/handlers/couriers_handler_test.go` (UpdateCourierStatus, ัััะฝะพะต ะฝะฐะทะฝะฐัะตะฝะธะต)
  - `internal/handlers/promo_codes_test.go` (CRUD + ะฒะฐะปะธะดะฐัะธะธ ะฟัะพะผะพะบะพะดะพะฒ)
  - `internal/handlers/analytics_test.go` (JSON/CSV, ะฒะฐะปะธะดะฐัะธั ะดะฐั/ะฟะฐัะฐะผะตััะพะฒ, timeout)
  - `internal/services/*_test.go` (promo_service, courier_assignment_service, geocoding_service.FirstPos ะธ ะดั.)
- ะัะพะฒะตัะบะฐ:
  - `go test ./...`
  - `go test ./... -coverprofile=/tmp/cover.out && go tool cover -func=/tmp/cover.out | tail -n 1`

## ะััััะฐั ะฟัะพะฒะตัะบะฐ
1) `make up && make health` (ะพะถะธะดะฐะตะผ `status=healthy`).
2) `curl "http://localhost:8080/api/analytics/kpi?from=$(date +%Y-%m-01)&to=$(date +%Y-%m-%d)&group_by=day"` (ะพะถะธะดะฐะตะผ `200` + JSON).
3) CI/CD: GitHub Actions workflows ะฒ `.github/workflows/` (CI + integration + release).

## Troubleshooting (ะตัะปะธ ััะพ-ัะพ ะฝะต ะฟะพะดะฝัะปะพัั)
- ะัะพะฒะตัะธัั, ััะพ ะบะพะฝัะตะนะฝะตัั ะทะฐะฟััะตะฝั ะธ ะฟะพััั ะฟัะพะฑัะพัะตะฝั: `docker compose ps`
- ะะพัะผะพััะตัั, ััะพ ะธะผะตะฝะฝะพ ะฝะต ะทะดะพัะพะฒะพ (ะฒ ะพัะฒะตัะต `/health` ะตััั ััะฐัััั `database/redis/kafka`): `curl -i http://localhost:8080/health`
- ะะพะณะธ ะฟัะธะปะพะถะตะฝะธั: `docker compose logs --tail=200 delivery-app`
- ะะพะณะธ ะทะฐะฒะธัะธะผะพััะตะน:
  - Postgres: `docker compose logs --tail=200 postgres`
  - Kafka: `docker compose logs --tail=200 kafka`
  - Redis: `docker compose logs --tail=200 redis`
- ะัะปะธ ะผะธะณัะฐัะธะธ ะฝะต ะฟัะธะผะตะฝะธะปะธัั/ะดะฐะฝะฝัะต โะฑะธััะตโ (ัะตะดะบะพ): `docker compose down -v && docker compose up -d --build` (ัะดะฐะปะธั volumes ั ะดะฐะฝะฝัะผะธ)

